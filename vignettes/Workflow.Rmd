---
title: "Workflow"
author: "Dr Jeremiah MF Kelly"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Workflow}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

The following describes the work flow for the analysis of dark adaptation data. The data were extracted from Figure 1 in Rushton's paradox: rod dark adaptation after flash photolysis, E.N.Pugh Jr. \emph{The Journal of Physiology,} 1975. 

A 'dark' object can have up to 16 elements and no fewer than 2. 

```{r, cache=TRUE}
# test
library(Dark)
data(dark)
tmp<-dark
names(tmp)
```

The function `Start` generates an array of possible parameter values calculated from the data, which are then passed to `ModelSelect`. The purpose of `ModelSelect` is to return parameter estimates and AIC scores. 


```{r, fig.width=6, fig.height=6, fig.align='center'}
set.seed(1234)
par(las=1, bty='n',mfrow=c(1,1))
plot(tmp$time, tmp$thrs)

P<-Start(tmp, 2000)
MSC<-ModelSelect(tmp,P)
MSC
```

We can then use the `BestFit` to find an optimal fit using the starting points from the brute force search. 

```{r, fig.width=6, fig.height=6, fig.align='center'}
set.seed(1234)
par(las=1, bty='n',mfrow=c(1,1))
plot(tmp$time, tmp$thrs)
tmp<-BestFit(tmp,MSC, T)
```

A further function `MultiStart` ensures that the estimated parameter values are optimal by repeatedly optimising the model with starting locations in the vicinity of the initial estimate. Finally `BootDark` uses bootstrap methods to calculate confidence intervals for the parameter estimates.


```{r, fig.width=6, fig.height=6, fig.align='center'}
par(las=1, bty='n')
tmp<-MultiStart(tmp,repeats = 25)
tmp<-BootDark(tmp,R = 150, T)

```


The final `dark` object with 15 elements:

```{r}
tmp
```
